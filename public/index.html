<!DOCTYPE html>
<html>
  <head><title>Reversi Lobby</title></head>
  <body>
    <h1>Lobby</h1>

    <!-- ルームリンク -->
    <div>
      <h2>Room 1</h2>
      <a href="room.html?id=1&seat=black">Black</a> |
      <a href="room.html?id=1&seat=white">White</a> |
      <a href="room.html?id=1&seat=observer">Observer</a>
    </div>
    <div>
      <h2>Room 2</h2>
      <a href="room.html?id=2&seat=black">Black</a> |
      <a href="room.html?id=2&seat=white">White</a> |
      <a href="room.html?id=2&seat=observer">Observer</a>
    </div>
    <div>
      <h2>Room 3</h2>
      <a href="room.html?id=3&seat=black">Black</a> |
      <a href="room.html?id=3&seat=white">White</a> |
      <a href="room.html?id=3&seat=observer">Observer</a>
    </div>
    <div>
      <h2>Room 4</h2>
      <a href="room.html?id=4&seat=black">Black</a> |
      <a href="room.html?id=4&seat=white">White</a> |
      <a href="room.html?id=4&seat=observer">Observer</a>
    </div>

    <hr>

    <!-- デバッグ用ブロードキャスト表示 -->
    <h2>Broadcast Debug (Room 1 Observer)</h2>
    <pre id="debug"></pre>

    <script>
      // --- Room 1 に observer として接続 ---
      const ws = new WebSocket(`wss://${location.host}/1/ws`)

      ws.addEventListener("open", () => {
        console.log("connected as observer to room 1")
        ws.send(JSON.stringify({ event: "join", seat: "observer" }))
      })

      ws.addEventListener("message", (evt) => {
        try {
          const msg = JSON.parse(evt.data)
          console.log("recv:", msg)

          const debug = document.getElementById("debug")
          debug.textContent += `[${msg.event}] ${JSON.stringify(msg.data)}\n`
        } catch (e) {
          console.error("invalid message:", evt.data)
        }
      })
    </script>
  </body>
</html>