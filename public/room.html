<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Reversi Room (Minimal Join Only)</title>
    <style>
      body { font-family: sans-serif; }
      .board { display: grid; grid-template-columns: repeat(8, 40px); grid-gap: 2px; margin: 20px 0; }
      .cell { width: 40px; height: 40px; background: green; display: flex; align-items: center; justify-content: center; }
      .disc { width: 30px; height: 30px; border-radius: 50%; }
      .black { background: black; }
      .white { background: white; border: 1px solid #000; }
    </style>
  </head>
  <body>
    <h1>Reversi Room (Minimal Join Only)</h1>
    <div id="status"></div>
    <div id="board" class="board"></div>

    <script>
      const params = new URLSearchParams(location.search)
      const roomId = params.get("id")
      const seat = params.get("seat") || "observer"

      // --- WebSocket 接続 ---
      let ws = new WebSocket(`wss://${location.host}/${roomId}/ws`)

      ws.onopen = () => {
        console.log("connected")
        ws.send(JSON.stringify({ action: "join", seat }))
      }

      const boardEl = document.getElementById("board")
      const statusEl = document.getElementById("status")

      // --- 盤面描画 ---
      function renderBoard(board) {
        console.log("renderBoard called", board)
        boardEl.innerHTML = ""
        for (let y = 0; y < 8; y++) {
          for (let x = 0; x < 8; x++) {
            const cellEl = document.createElement("div")
            cellEl.className = "cell"
            const c = board[y][x]
            if (c === "B" || c === "W") {
              const disc = document.createElement("div")
              disc.className = "disc " + (c === "B" ? "black" : "white")
              cellEl.appendChild(disc)
            }
            boardEl.appendChild(cellEl)
          }
        }
      }

      // --- メッセージ受信 ---
      ws.onmessage = (ev) => {
        const msg = JSON.parse(ev.data)
        console.log("event:", msg.event, msg.data)
        if (msg.event === "join" && msg.data && msg.data.board) {
          renderBoard(msg.data.board)
          if (msg.data.status) {
            statusEl.textContent = "Status: " + msg.data.status
          }
        }
      }
    </script>
  </body>
</html>