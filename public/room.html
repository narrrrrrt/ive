ws.addEventListener("message", (evt) => {
  try {
    const msg = JSON.parse(evt.data)
    console.log("recv:", msg)

    // デバッグ表示を強化
    const debug = document.getElementById("log")
    debug.textContent += `[${msg.event}] ${JSON.stringify(msg.data)}\n`

    if (msg.event === "join") {
      console.log("join event payload:", msg.data)
      const { board, status, black, white } = msg.data
      if (board) renderBoard(board)
      if (status) renderStatus(status, black, white)
    } else if (msg.event === "move") {
      const { board, status } = msg.data
      renderBoard(board)
      renderStatus(status)
    } else if (msg.event === "leave") {
      const { status, black, white } = msg.data
      renderStatus(status, black, white)
    }
  } catch (e) {
    console.error("invalid message:", evt.data)
  }
})