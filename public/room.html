<!DOCTYPE html>
<html>
  <head>
    <title>Reversi Room</title>
    <style>
      body { font-family: sans-serif; }
      #board button {
        width: 28px; height: 28px;
        margin: 1px; text-align: center;
      }
      #board div { line-height: 0; }
      pre { background: #eee; padding: 6px; }
    </style>
  </head>
  <body>
    <h1>Reversi Room</h1>
    <div id="status">waiting...</div>

    <!-- 盤面 -->
    <div id="board"></div>

    <hr>
    <h2>Debug</h2>
    <pre id="debug"></pre>

    <script>
      const url = new URL(location.href)
      const roomId = url.searchParams.get("id") || "1"
      const seat = url.searchParams.get("seat") || "observer"

      const ws = new WebSocket(`wss://${location.host}/${roomId}/ws`)

      ws.onopen = () => {
        ws.send(JSON.stringify({ event: "join", seat }))
      }

      ws.onmessage = (msg) => {
        const { event, data } = JSON.parse(msg.data)
        logDebug(event, data)

        if (data && data.board) {
          renderBoard(data.board)
        }
        if (data && data.status) {
          document.getElementById("status").textContent = JSON.stringify(data.status)
        }
      }

      function renderBoard(board) {
        const div = document.getElementById("board")
        div.innerHTML = ""

        board.forEach((row, y) => {
          const rowDiv = document.createElement("div")
          row.split("").forEach((cell, x) => {
            const btn = document.createElement("button")
            btn.textContent = cell === "." ? "-" : cell
            btn.onclick = () => {
              ws.send(JSON.stringify({ event: "move", x, y }))
            }
            rowDiv.appendChild(btn)
          })
          div.appendChild(rowDiv)
        })
      }

      function logDebug(event, data) {
        const debug = document.getElementById("debug")
        debug.textContent += `[${event}] ${JSON.stringify(data)}\n`
        debug.scrollTop = debug.scrollHeight
      }
    </script>
  </body>
</html>